<!DOCTYPE html>
<html>
<head>
  <title>Calculateur de temps de livraison</title>
</head>
<body>
  <table id="tableau"></table>
  <script>
    let dataC = [];
    let dataP = [];
    async function getDatasC() {
      console.log("Fetching Google API");
    const response = await fetch ("https://sheets.googleapis.com/v4/spreadsheets/1clXfkqBSq5w9wYUW7ztSeLYMCjh9mZQGdXhMOs9wzB4/values/Chaufferies!A:C?key=AIzaSyCZ_z9l9uecGSrVRdOD3ISnkte4zeoNPqA");
    const result = await response.json();
      console.log(result.values);
      dataC = result.values;
        await  getDatasP();
    }
    getDatasC();
     async function getDatasP() {
      console.log("Fetching Google API");
    const response = await fetch ("https://sheets.googleapis.com/v4/spreadsheets/1clXfkqBSq5w9wYUW7ztSeLYMCjh9mZQGdXhMOs9wzB4/values/Plateformes!A:C?key=AIzaSyCZ_z9l9uecGSrVRdOD3ISnkte4zeoNPqA");
    const result = await response.json();
      console.log(result.values);
      dataP = result.values;
       await createTable();
    }
async function getDistance(ax, ay, bx, by) {
  let checkpoint = ax + "," + ay + ";" + bx + "," + by + ";";
  console.log(checkpoint);
  const response = await fetch(`https://router.project-osrm.org/route/v1/driving/${checkpoint}?overview=full&geometries=geojson`);
  const result = await response.json();
  console.log("Résultat OSRM");
  console.log(result);
  return [result.time, result.distance];
}
async function createTable() {
  console.log("CreateTable");
    for (const chauf of dataC) {
      // Pour chaque chaudière
      for (const plat of dataP) {
        console.log(await getDistance(chauf[1], chauf[2], plat[1], plat[2]));
      }
    }
}

  </script>
</body>
</html>
